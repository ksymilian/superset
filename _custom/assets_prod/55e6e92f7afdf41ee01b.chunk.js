"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[5941,7510,3156],{42946:(e,t,r)=>{r.r(t),r.d(t,{default:()=>P});var a=r(18446),o=r.n(a),n=r(67294),i=r(45697),s=r.n(i),l=r(31069),c=r(37672),u=r(54998),p=r.n(u);function d(e,t,r,a){if(void 0===r&&(r=!0),void 0===a&&(a={}),!e.datasource)return null;const o=new(p())("/"),n=function(e,t){void 0===t&&(t="base");let r="/superset/explore/";return["json","csv","query","results","samples"].includes(t)&&(r="/superset/explore_json/"),r}(0,t),i=o.search(!0);Object.keys(a).forEach((e=>{i[e]=a[e]})),i.form_data=function(e){const t=new Set;return JSON.stringify(e,((e,r)=>{if("object"==typeof r&&null!==r){if(t.has(r))try{return JSON.parse(JSON.stringify(r))}catch(e){return}t.add(r)}return r}))}(e),"standalone"===t&&(i.standalone="true");const s=o.directory(n).search(i).toString();return!r&&s.length>8e3?d({datasource:e.datasource,viz_type:e.viz_type},t,!1,{URL_IS_TOO_LONG_TO_SHARE:null}):s}var g=r(23444),h=r(72738),f=r(51527),m=r(62625),v=r(46635),y=r(19519),b=r(1711),_=r(58010);const x={deck_grid:g.getLayer,deck_screengrid:h.getLayer,deck_path:f.getLayer,deck_hex:m.getLayer,deck_scatter:v.getLayer,deck_geojson:y.getLayer,deck_arc:b.getLayer,deck_polygon:_.getLayer};function j(){return j=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},j.apply(this,arguments)}function C(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const S={formData:s().object.isRequired,payload:s().object.isRequired,setControlValue:s().func.isRequired,viewport:s().object.isRequired,onAddFilter:s().func,onSelect:s().func},k={onAddFilter(){},onSelect(){}};class w extends n.PureComponent{constructor(e){super(e),C(this,"containerRef",n.createRef()),C(this,"setTooltip",(e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)})),this.state={subSlicesLayers:{}},this.onViewportChange=this.onViewportChange.bind(this)}componentDidMount(){const{formData:e,payload:t}=this.props;this.loadLayers(e,t)}UNSAFE_componentWillReceiveProps(e){const{formData:t,payload:r}=e;!o()(this.props.formData.deck_slices,e.formData.deck_slices)&&this.loadLayers(t,r)}onViewportChange(e){this.setState({viewport:e})}loadLayers(e,t,r){this.setState({subSlicesLayers:{},viewport:r}),t.data.slices.forEach((t=>{const r=[...t.form_data.filters||[],...e.filters||[],...e.extra_filters||[]],a=j({},t,{form_data:j({},t.form_data,{filters:r})});l.Z.get({endpoint:d(a.form_data,"json")}).then((e=>{let{json:t}=e;const r=x[a.form_data.viz_type](a.form_data,t,this.props.onAddFilter,this.setTooltip,[],this.props.onSelect);this.setState({subSlicesLayers:j({},this.state.subSlicesLayers,{[a.slice_id]:r})})})).catch((()=>{}))}))}render(){const{payload:e,formData:t,setControlValue:r}=this.props,{subSlicesLayers:a}=this.state,o=Object.values(a);return n.createElement(c.Z,{ref:this.containerRef,mapboxApiAccessToken:e.data.mapboxApiKey,viewport:this.state.viewport||this.props.viewport,layers:o,mapStyle:t.mapbox_style,setControlValue:r,onViewportChange:this.onViewportChange})}}w.propTypes=S,w.defaultProps=k;const P=w},19519:(e,t,r)=>{r.r(t),r.d(t,{getLayer:()=>b,default:()=>C});var a=r(67294),o=r(45697),n=r.n(o),i=r(21497),s=r(37672),l=r(27447),c=r(40895),u=r(38969),p=r(24084);function d(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function g(){return g=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},g.apply(this,arguments)}const h={fillColor:"fillColor",color:"fillColor",fill:"fillColor","fill-color":"fillColor",strokeColor:"strokeColor","stroke-color":"strokeColor","stroke-width":"strokeWidth"},f=(e,t)=>{const r={};return Object.keys(e).forEach((t=>{t in h?r[h[t]]=e[t]:r[t]=e[t]})),"string"==typeof e.fillColor&&(r.fillColor=(0,l.hexToRGB)(e.fillColor)),"string"==typeof e.strokeColor&&(r.strokeColor=(0,l.hexToRGB)(e.strokeColor)),g({},r,{},t)};let m;const v=(e,t,r)=>{if(e&&e.features&&e.features.forEach((a=>{v(a,t,e.extraProps||r)})),e&&e.geometry){const a=g({},e,{properties:f(e.properties,t)});a.extraProps||(a.extraProps=r),m.push(a)}};function y(e){return e.object.extraProps&&a.createElement("div",{className:"deckgl-tooltip"},Object.keys(e.object.extraProps).map(((t,r)=>a.createElement(p.Z,{key:"prop-"+r,label:t+": ",value:""+e.object.extraProps[t]}))))}function b(e,t,r,a){const o=e,n=o.fill_color_picker,s=o.stroke_color_picker,l=[n.r,n.g,n.b,255*n.a],p=[s.r,s.g,s.b,255*s.a],d={};let h;return l[3]>0&&(d.fillColor=l),p[3]>0&&(d.strokeColor=p),m=[],v(t.data,d),o.js_data_mutator&&(h=(0,c.Z)(o.js_data_mutator),m=h(m)),new i.Z(g({id:"geojson-layer-"+o.slice_id,filled:o.filled,data:m,stroked:o.stroked,extruded:o.extruded,pointRadiusScale:o.point_radius_scale},(0,u.N)(o,a,y)))}const _={formData:n().object.isRequired,payload:n().object.isRequired,setControlValue:n().func.isRequired,viewport:n().object.isRequired,onAddFilter:n().func},x={onAddFilter(){}};class j extends a.Component{constructor(){super(...arguments),d(this,"containerRef",a.createRef()),d(this,"setTooltip",(e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)}))}render(){const{formData:e,payload:t,setControlValue:r,onAddFilter:o,viewport:n}=this.props,i=b(e,t,0,this.setTooltip);return a.createElement(s.Z,{ref:this.containerRef,mapboxApiAccessToken:t.data.mapboxApiKey,viewport:n,layers:[i],mapStyle:e.mapbox_style,setControlValue:r})}}j.propTypes=_,j.defaultProps=x;const C=j},23444:(e,t,r)=>{r.r(t),r.d(t,{getLayer:()=>d,default:()=>g});var a=r(99396),o=r(67294),n=r(61988),i=r(38969),s=r(40895),l=r(75647),c=r(24084);function u(){return u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},u.apply(this,arguments)}function p(e){return o.createElement("div",{className:"deckgl-tooltip"},o.createElement(c.Z,{label:(0,n.t)("Longitude and Latitude")+": ",value:e.coordinate[0]+", "+e.coordinate[1]}),o.createElement(c.Z,{label:(0,n.t)("Height")+": ",value:""+e.object.elevationValue}))}function d(e,t,r,o){const n=e,l=n.color_picker;let c=t.data.features.map((e=>u({},e,{color:[l.r,l.g,l.b,255*l.a]})));n.js_data_mutator&&(c=(0,s.Z)(n.js_data_mutator)(c));const d=(0,i.Z)(n.js_agg_function,(e=>e.weight));return new a.Z(u({id:"grid-layer-"+n.slice_id,data:c,pickable:!0,cellSize:n.grid_size,minColor:[0,0,0,0],extruded:n.extruded,maxColor:[l.r,l.g,l.b,255*l.a],outline:!1,getElevationValue:d,getColorValue:d},(0,i.N)(n,o,p)))}const g=(0,l.G)(d,(function(e){return e.map((e=>e.position))}))},62625:(e,t,r)=>{r.r(t),r.d(t,{default:()=>k,getLayer:()=>S});var a=r(80744),o=r(15103),n=r(4516),i=Math.PI/3,s=[0,i,2*i,3*i,4*i,5*i];function l(e){return e[0]}function c(e){return e[1]}var u=r(38550),p=r(73728),d=r(63295);function g(){}const h={colorDomain:null,colorRange:n.K,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",value:0,min:0,max:100},upperPercentile:{type:"number",value:100,min:0,max:100},colorScaleType:"quantize",onSetColorDomain:g,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",value:0,min:0,max:100},elevationUpperPercentile:{type:"number",value:100,min:0,max:100},elevationScale:{type:"number",min:0,value:1},elevationScaleType:"linear",onSetElevationDomain:g,radius:{type:"number",value:1e3,min:1},coverage:{type:"number",min:0,max:1,value:1},extruded:!1,hexagonAggregator:function(e,t){const{data:r,radius:o}=e,{viewport:n,attributes:p}=t,d=r.length?function(e,t){const{attributes:r}=t,a=r.positions.value,{size:o}=r.positions.getAccessor();let n,i=1/0,s=1/0,l=-1/0,c=-1/0;for(n=0;n<o*e.length;n+=o){const e=a[n],t=a[n+1];Number.isFinite(e)&&Number.isFinite(t)&&(i=Math.min(e,i),l=Math.max(e,l),s=Math.min(t,s),c=Math.max(t,c))}return[i,s,l,c].every(Number.isFinite)?[(i+l)/2,(s+c)/2]:null}(r,t):null,g=function(e,t,r){const{unitsPerMeter:a}=t.getDistanceScales(r);return e*a[0]}(o,n,d),h=[],{iterable:f,objectInfo:m}=(0,u.jB)(r),v=p.positions.value,{size:y}=p.positions.getAccessor();for(const e of f){m.index++;const t=m.index*y,r=[v[t],v[t+1]];Number.isFinite(r[0])&&Number.isFinite(r[1])?h.push({screenCoord:n.projectFlat(r),source:e,index:m.index}):a.Z.warn("HexagonLayer: invalid position")()}const b=function(){var e,t,r,a=0,o=0,n=1,u=1,p=l,d=c;function g(e){var a,o={},n=[],i=e.length;for(a=0;a<i;++a)if(!isNaN(l=+p.call(null,s=e[a],a,e))&&!isNaN(c=+d.call(null,s,a,e))){var s,l,c,u=Math.round(c/=r),g=Math.round(l=l/t-(1&u)/2),h=c-u;if(3*Math.abs(h)>1){var f=l-g,m=g+(l<g?-1:1)/2,v=u+(c<u?-1:1),y=l-m,b=c-v;f*f+h*h>y*y+b*b&&(g=m+(1&u?1:-1)/2,u=v)}var _=g+"-"+u,x=o[_];x?x.push(s):(n.push(x=o[_]=[s]),x.x=(g+(1&u)/2)*t,x.y=u*r)}return n}function h(e){var t=0,r=0;return s.map((function(a){var o=Math.sin(a)*e,n=-Math.cos(a)*e,i=o-t,s=n-r;return t=o,r=n,[i,s]}))}return g.hexagon=function(t){return"m"+h(null==t?e:+t).join("l")+"z"},g.centers=function(){for(var i=[],s=Math.round(o/r),l=Math.round(a/t),c=s*r;c<u+e;c+=r,++s)for(var p=l*t+(1&s)*t/2;p<n+t/2;p+=t)i.push([p,c]);return i},g.mesh=function(){var t=h(e).slice(0,4).join("l");return g.centers().map((function(e){return"M"+e+"m"+t})).join("")},g.x=function(e){return arguments.length?(p=e,g):p},g.y=function(e){return arguments.length?(d=e,g):d},g.radius=function(a){return arguments.length?(t=2*(e=+a)*Math.sin(i),r=1.5*e,g):e},g.size=function(e){return arguments.length?(a=o=0,n=+e[0],u=+e[1],g):[n-a,u-o]},g.extent=function(e){return arguments.length?(a=+e[0][0],o=+e[0][1],n=+e[1][0],u=+e[1][1],g):[[a,o],[n,u]]},g.radius(1)}().radius(g).x((e=>e.screenCoord[0])).y((e=>e.screenCoord[1]));return{hexagons:b(h).map(((e,t)=>({position:n.unprojectFlat([e.x,e.y]),points:e,index:t}))),radiusCommon:g}},getPosition:{type:"accessor",value:e=>e.position},material:!0,_filterData:{type:"function",value:null,optional:!0}};class f extends d.Z{shouldUpdateState({changeFlags:e}){return e.somethingChanged}initializeState(){const e=new p.Z({getAggregator:e=>e.hexagonAggregator,getCellSize:e=>e.radius});this.state={cpuAggregator:e,aggregatorState:e.state,hexagonVertices:null},this.getAttributeManager().add({positions:{size:3,accessor:"getPosition"}})}updateState(e){super.updateState(e);const{cpuAggregator:t,hexagonVertices:r}=this.state;e.changeFlags.propsOrDataChanged&&this.setState({aggregatorState:t.updateState(e,{viewport:this.context.viewport,attributes:this.getAttributes()})});const{hexagonVertices:a}=t.state.layerData||{};if(a&&r!==a){const e=this.convertLatLngToMeterOffset(a);e&&this.setState({hexagonVertices:a,vertices:e})}else this.updateRadiusAngle()}updateRadiusAngle(e){const{viewport:t}=this.context,{unitsPerMeter:r}=t.getDistanceScales(),{cpuAggregator:a}=this.state;if(a.state.layerData&&a.state.layerData.radiusCommon){const{radiusCommon:e}=a.state.layerData,t=e/r[0];this.setState({angle:90,radius:t})}}convertLatLngToMeterOffset(e){const{viewport:t}=this.context;if(Array.isArray(e)&&6===e.length){const r=e[0],a=e[3],o=[(r[0]+a[0])/2,(r[1]+a[1])/2],n=t.projectFlat(o),{metersPerUnit:i}=t.getDistanceScales(o);return e.map((e=>{const r=t.projectFlat(e);return[(r[0]-n[0])*i[0],(r[1]-n[1])*i[1]]}))}return a.Z.error("HexagonLayer: hexagonVertices needs to be an array of 6 points")(),null}getPickingInfo({info:e}){return this.state.cpuAggregator.getPickingInfo({info:e})}_onGetSublayerColor(e){return this.state.cpuAggregator.getAccessor("fillColor")(e)}_onGetSublayerElevation(e){return this.state.cpuAggregator.getAccessor("elevation")(e)}_getSublayerUpdateTriggers(){return this.state.cpuAggregator.getUpdateTriggers(this.props)}renderLayers(){const{elevationScale:e,extruded:t,coverage:r,material:a,transitions:n}=this.props,{angle:i,radius:s,cpuAggregator:l,vertices:c}=this.state,u=this.getSubLayerClass("hexagon-cell",o.Z),p=this._getSublayerUpdateTriggers();return new u({...c&&c.length?{vertices:c,radius:1}:{radius:s,angle:i},diskResolution:6,elevationScale:e,extruded:t,coverage:r,material:a,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:n&&{getFillColor:n.getColorValue||n.getColorWeight,getElevation:n.getElevationValue||n.getElevationWeight}},this.getSubLayerProps({id:"hexagon-cell",updateTriggers:p}),{data:l.state.layerData.data})}}f.layerName="HexagonLayer",f.defaultProps=h;var m=r(67294),v=r(61988),y=r(38969),b=r(40895),_=r(75647),x=r(24084);function j(){return j=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},j.apply(this,arguments)}function C(e){return m.createElement("div",{className:"deckgl-tooltip"},m.createElement(x.Z,{label:(0,v.t)("Centroid (Longitude and Latitude)")+": ",value:"("+e.coordinate[0]+", "+e.coordinate[1]+")"}),m.createElement(x.Z,{label:(0,v.t)("Height")+": ",value:""+e.object.elevationValue}))}function S(e,t,r,a){const o=e,n=o.color_picker;let i=t.data.features.map((e=>j({},e,{color:[n.r,n.g,n.b,255*n.a]})));o.js_data_mutator&&(i=(0,b.Z)(o.js_data_mutator)(i));const s=(0,y.Z)(o.js_agg_function,(e=>e.weight));return new f(j({id:"hex-layer-"+o.slice_id,data:i,pickable:!0,radius:o.grid_size,minColor:[0,0,0,0],extruded:o.extruded,maxColor:[n.r,n.g,n.b,255*n.a],outline:!1,getElevationValue:s,getColorValue:s},(0,y.N)(o,a,C)))}const k=(0,_.G)(S,(function(e){return e.map((e=>e.position))}))},51527:(e,t,r)=>{r.r(t),r.d(t,{getLayer:()=>p,default:()=>d});var a=r(62112),o=r(67294),n=r(38969),i=r(40895),s=r(75647),l=r(24084);function c(){return c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},c.apply(this,arguments)}function u(e){return e.object.extraProps&&o.createElement("div",{className:"deckgl-tooltip"},Object.keys(e.object.extraProps).map(((t,r)=>o.createElement(l.Z,{key:"prop-"+r,label:t+": ",value:""+e.object.extraProps[t]}))))}function p(e,t,r,o){const s=e,l=s.color_picker,p=[l.r,l.g,l.b,255*l.a];let d=t.data.features.map((e=>c({},e,{path:e.path,width:s.line_width,color:p})));return s.js_data_mutator&&(d=(0,i.Z)(s.js_data_mutator)(d)),new a.Z(c({id:"path-layer-"+s.slice_id,getColor:e=>e.color,getPath:e=>e.path,getWidth:e=>e.width,data:d,rounded:!0,widthScale:1},(0,n.N)(s,o,u)))}const d=(0,s.G)(p,(function(e){let t=[];return e.forEach((e=>{t=t.concat(e.path)})),t}))},46635:(e,t,r)=>{r.r(t),r.d(t,{default:()=>d,getLayer:()=>p});var a=r(28569),o=r(67294),n=r(61988),i=r(38969),s=r(75647),l=r(24084);const c=1609.34;function u(){return u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},u.apply(this,arguments)}function p(e,t,r,s){const p=e,d=t.data.features.map((e=>{let t=(r=p.point_unit,a=e.radius,("square_m"===r?Math.sqrt(a/Math.PI):"radius_m"===r?a:"radius_km"===r?1e3*a:"radius_miles"===r?a*c:"square_km"===r?1e3*Math.sqrt(a/Math.PI):"square_miles"===r?Math.sqrt(a/Math.PI)*c:null)||10);var r,a;if(p.multiplier&&(t*=p.multiplier),e.color)return u({},e,{radius:t});const o=p.color_picker||{r:0,g:0,b:0,a:1};return u({},e,{radius:t,color:[o.r,o.g,o.b,255*o.a]})}));return new a.Z(u({id:"scatter-layer-"+p.slice_id,data:d,fp64:!0,getFillColor:e=>e.color,getRadius:e=>e.radius,radiusMinPixels:p.min_radius||null,radiusMaxPixels:p.max_radius||null,stroked:!1},(0,i.N)(p,s,function(e){return t=>o.createElement("div",{className:"deckgl-tooltip"},o.createElement(l.Z,{label:(0,n.t)("Longitude and Latitude")+": ",value:t.object.position[0]+", "+t.object.position[1]}),t.object.cat_color&&o.createElement(l.Z,{label:(0,n.t)("Category")+": ",value:""+t.object.cat_color}),t.object.metric&&o.createElement(l.Z,{label:e.point_radius_fixed.value.label+": ",value:""+t.object.metric}))}(p))))}const d=(0,s.B)(p,(function(e){return e.map((e=>e.position))}))}}]);
//# sourceMappingURL=55e6e92f7afdf41ee01b.chunk.js.map