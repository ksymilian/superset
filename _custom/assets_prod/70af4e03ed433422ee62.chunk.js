(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[6274],{78918:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});var o=r(95772),s=r(63803),i=r(61855);class n extends o.Z{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every((e=>e.isLoaded))}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id?(e.object=t.__source.object,e.index=t.__source.index,e):e}renderLayers(){return null}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){const{_subLayerProps:r}=this.props;return t&&t.length||r&&r[e]}getSubLayerClass(e,t){const{_subLayerProps:r}=this.props;return r&&r[e]&&r[e].type||t}getSubLayerRow(e,t,r){return e.__source={parent:this,object:t,index:r},e}getSubLayerAccessor(e){if("function"==typeof e){const t={data:this.props.data,target:[]};return(r,o)=>r&&r.__source?(t.index=r.__source.index,e(r.__source.object,t)):e(r,o)}return e}getSubLayerProps(e={}){const{opacity:t,pickable:r,visible:o,parameters:s,getPolygonOffset:i,highlightedObjectIndex:n,autoHighlight:a,highlightColor:l,coordinateSystem:c,coordinateOrigin:p,wrapLongitude:u,positionFormat:d,modelMatrix:h,extensions:g,fetch:f,_subLayerProps:y}=this.props,b={opacity:t,pickable:r,visible:o,parameters:s,getPolygonOffset:i,highlightedObjectIndex:n,autoHighlight:a,highlightColor:l,coordinateSystem:c,coordinateOrigin:p,wrapLongitude:u,positionFormat:d,modelMatrix:h,extensions:g,fetch:f},m=y&&y[e.id],v=m&&m.updateTriggers,_=e.id||"sublayer";if(m){const t=this.constructor._propTypes,r=e.type?e.type._propTypes:{};for(const e in m){const o=r[e]||t[e];o&&"accessor"===o.type&&(m[e]=this.getSubLayerAccessor(m[e]))}}Object.assign(b,e,m),b.id="".concat(this.props.id,"-").concat(_),b.updateTriggers={all:this.props.updateTriggers.all,...e.updateTriggers,...v};for(const e of g){const t=e.getSubLayerProps.call(this,e);t&&Object.assign(b,t,{updateTriggers:Object.assign(b.updateTriggers,t.updateTriggers)})}return b}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_renderLayers(){let{subLayers:e}=this.internalState;const t=!e||this.needsUpdate();t&&(e=this.renderLayers(),e=(0,i.x)(e,Boolean),this.internalState.subLayers=e),(0,s.Z)("compositeLayer.renderLayers",this,t,e);for(const t of e)t.parent=this}}n.layerName="CompositeLayer"},37672:(e,t,r)=>{"use strict";r.d(t,{Z:()=>g});var o=r(67294),s=r(45697),i=r.n(s),n=r(98601),a=r(65274),l=r(51995),c=r(68924);function p(e){const{tooltip:t}=e;if(null==t)return null;const{x:r,y:s,content:i}=t,n=(0,o.useMemo)((()=>({position:"absolute",top:s+"px",left:r+"px",padding:"8px",margin:"8px",background:"rgba(0, 0, 0, 0.8)",color:"#fff",maxWidth:"300px",fontSize:"12px",zIndex:9,pointerEvents:"none"})),[r,s]);if("string"==typeof i){const e=(0,o.useMemo)((()=>({__html:(0,c.filterXSS)(i,{stripIgnoreTag:!0})})),[i]);return o.createElement("div",{style:n},o.createElement("div",{dangerouslySetInnerHTML:e}))}return o.createElement("div",{style:n},i)}function u(){const e=(t=["\n  .deckgl-tooltip > div {\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n"],r||(r=t.slice(0)),t.raw=r,t);var t,r;return u=function(){return e},e}const d={viewport:i().object.isRequired,layers:i().array.isRequired,setControlValue:i().func,mapStyle:i().string,mapboxApiAccessToken:i().string.isRequired,children:i().node,bottomMargin:i().number,width:i().number.isRequired,height:i().number.isRequired};class h extends o.Component{constructor(e){var t,r;super(e),r=e=>{this.setState({tooltip:e})},(t="setTooltip")in this?Object.defineProperty(this,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[t]=r,this.tick=this.tick.bind(this),this.onViewStateChange=this.onViewStateChange.bind(this),this.state={timer:setInterval(this.tick,250),tooltip:null,viewState:e.viewport}}componentWillUnmount(){clearInterval(this.state.timer)}onViewStateChange(e){let{viewState:t}=e;this.setState({viewState:t,lastUpdate:Date.now()})}tick(){const{lastUpdate:e}=this.state;if(e&&Date.now()-e>250){const e=this.props.setControlValue;e&&e("viewport",this.state.viewState),this.setState({lastUpdate:null})}}layers(){return this.props.layers.some((e=>"function"==typeof e))?this.props.layers.map((e=>"function"==typeof e?e():e)):this.props.layers}render(){const{children:e,bottomMargin:t,height:r,width:s}=this.props,{viewState:i,tooltip:l}=this.state,c=r-t,u=this.layers();return o.createElement(o.Fragment,null,o.createElement("div",{style:{position:"relative",width:s,height:c}},o.createElement(a.Z,{initWebGLParameters:!0,controller:!0,width:s,height:c,layers:u,viewState:i,glOptions:{preserveDrawingBuffer:!0},onViewStateChange:this.onViewStateChange},o.createElement(n.Z3,{preserveDrawingBuffer:!0,mapStyle:this.props.mapStyle,mapboxApiAccessToken:this.props.mapboxApiAccessToken})),e),o.createElement(p,{tooltip:l}))}}h.propTypes=d,h.defaultProps={mapStyle:"light",setControlValue:()=>{},children:null,bottomMargin:0};const g=(0,l.iK)(h)(u())},24084:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var o=r(67294),s=r(45697),i=r.n(s);const n={label:i().string.isRequired,value:i().string.isRequired};class a extends o.PureComponent{render(){const{label:e,value:t}=this.props;return o.createElement("div",null,e,o.createElement("strong",null,t))}}a.propTypes=n},19519:(e,t,r)=>{"use strict";r.r(t),r.d(t,{getLayer:()=>v,default:()=>k});var o=r(67294),s=r(45697),i=r.n(s),n=r(21497),a=r(37672),l=r(27447),c=r(40895),p=r(38969),u=r(24084);function d(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function h(){return h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},h.apply(this,arguments)}const g={fillColor:"fillColor",color:"fillColor",fill:"fillColor","fill-color":"fillColor",strokeColor:"strokeColor","stroke-color":"strokeColor","stroke-width":"strokeWidth"},f=(e,t)=>{const r={};return Object.keys(e).forEach((t=>{t in g?r[g[t]]=e[t]:r[t]=e[t]})),"string"==typeof e.fillColor&&(r.fillColor=(0,l.hexToRGB)(e.fillColor)),"string"==typeof e.strokeColor&&(r.strokeColor=(0,l.hexToRGB)(e.strokeColor)),h({},r,{},t)};let y;const b=(e,t,r)=>{if(e&&e.features&&e.features.forEach((o=>{b(o,t,e.extraProps||r)})),e&&e.geometry){const o=h({},e,{properties:f(e.properties,t)});o.extraProps||(o.extraProps=r),y.push(o)}};function m(e){return e.object.extraProps&&o.createElement("div",{className:"deckgl-tooltip"},Object.keys(e.object.extraProps).map(((t,r)=>o.createElement(u.Z,{key:"prop-"+r,label:t+": ",value:""+e.object.extraProps[t]}))))}function v(e,t,r,o){const s=e,i=s.fill_color_picker,a=s.stroke_color_picker,l=[i.r,i.g,i.b,255*i.a],u=[a.r,a.g,a.b,255*a.a],d={};let g;return l[3]>0&&(d.fillColor=l),u[3]>0&&(d.strokeColor=u),y=[],b(t.data,d),s.js_data_mutator&&(g=(0,c.Z)(s.js_data_mutator),y=g(y)),new n.Z(h({id:"geojson-layer-"+s.slice_id,filled:s.filled,data:y,stroked:s.stroked,extruded:s.extruded,pointRadiusScale:s.point_radius_scale},(0,p.N)(s,o,m)))}const _={formData:i().object.isRequired,payload:i().object.isRequired,setControlValue:i().func.isRequired,viewport:i().object.isRequired,onAddFilter:i().func},x={onAddFilter(){}};class S extends o.Component{constructor(){super(...arguments),d(this,"containerRef",o.createRef()),d(this,"setTooltip",(e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)}))}render(){const{formData:e,payload:t,setControlValue:r,onAddFilter:s,viewport:i}=this.props,n=v(e,t,0,this.setTooltip);return o.createElement(a.Z,{ref:this.containerRef,mapboxApiAccessToken:t.data.mapboxApiKey,viewport:i,layers:[n],mapStyle:e.mapbox_style,setControlValue:r})}}S.propTypes=_,S.defaultProps=x;const k=S},38969:(e,t,r)=>{"use strict";r.d(t,{N:()=>i,Z:()=>a});var o=r(4065),s=r(40895);function i(e,t,r,o){const i=e;let n,a,l=r;return i.js_tooltip&&(l=(0,s.Z)(i.js_tooltip)),l&&(n=e=>{e.picked?t({content:l(e),x:e.x,y:e.y}):t(null)}),i.js_onclick_href?a=e=>{const t=(0,s.Z)(i.js_onclick_href)(e);window.open(t)}:i.table_filter&&void 0!==o&&(a=e=>o(e.object[i.line_column])),{onClick:a,onHover:n,pickable:Boolean(n)}}const n={p1:.01,p5:.05,p95:.95,p99:.99};function a(e,t){if(void 0===e&&(e="sum"),void 0===t&&(t=null),"count"===e)return e=>e.length;let r;return r=e in n?(r,s)=>{let i;return i=t?r.sort(((e,r)=>o.ascending(t(e),t(r)))):r.sort(o.ascending),o.quantile(i,n[e],s)}:o[e],t?e=>r(e.map((e=>t(e)))):e=>r(e)}},27447:(e,t,r)=>{"use strict";r.r(t),r.d(t,{hexToRGB:()=>s});var o=r(16372);function s(e,t){if(void 0===t&&(t=255),!e)return[0,0,0,t];const{r,g:s,b:i}=(0,o.B8)(e);return[r,s,i,t]}},40895:(e,t,r)=>{"use strict";r.d(t,{Z:()=>p});var o=r(55140),s=r.n(o),i=r(77963),n=r(4065),a=r(27447);function l(){return l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},l.apply(this,arguments)}const c={console,_:i.ZP,colors:a,d3array:n};function p(e,t,r){const o={},i="SAFE_EVAL_"+Math.floor(1e6*Math.random());o[i]={};const n=i+"="+e,a=l({},c,{},t);Object.keys(a).forEach((e=>{o[e]=a[e]}));try{return s().runInNewContext(n,o,r),o[i]}catch(e){return()=>e}}},92540:()=>{},75307:()=>{}}]);
//# sourceMappingURL=70af4e03ed433422ee62.chunk.js.map