"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[8266,7510,3156],{95644:(t,e,i)=>{i.d(e,{N:()=>s});const o="#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))\n\nstruct AmbientLight {\n vec3 color;\n};\n\nstruct PointLight {\n vec3 color;\n vec3 position;\n vec3 attenuation;\n};\n\nstruct DirectionalLight {\n  vec3 color;\n  vec3 direction;\n};\n\nuniform AmbientLight lighting_uAmbientLight;\nuniform PointLight lighting_uPointLight[MAX_LIGHTS];\nuniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];\nuniform int lighting_uPointLightCount;\nuniform int lighting_uDirectionalLightCount;\n\nuniform bool lighting_uEnabled;\n\nfloat getPointLightAttenuation(PointLight pointLight, float distance) {\n  return pointLight.attenuation.x\n       + pointLight.attenuation.y * distance\n       + pointLight.attenuation.z * distance * distance;\n}\n\n#endif\n",n={lightSources:{}};function r({color:t=[0,0,0],intensity:e=1}={}){return t.map((t=>t*e/255))}const a={};const s={name:"gouraud-lighting",dependencies:[{name:"lights",vs:o,fs:o,getUniforms:function t(e=n){if("lightSources"in e){const{ambientLight:t,pointLights:i,directionalLights:o}=e.lightSources||{};return t||i&&i.length>0||o&&o.length>0?Object.assign({},function({ambientLight:t,pointLights:e=[],directionalLights:i=[]}){const o={};return o["lighting_uAmbientLight.color"]=t?r(t):[0,0,0],e.forEach(((t,e)=>{o["lighting_uPointLight[".concat(e,"].color")]=r(t),o["lighting_uPointLight[".concat(e,"].position")]=t.position,o["lighting_uPointLight[".concat(e,"].attenuation")]=t.attenuation||[1,0,0]})),o.lighting_uPointLightCount=e.length,i.forEach(((t,e)=>{o["lighting_uDirectionalLight[".concat(e,"].color")]=r(t),o["lighting_uDirectionalLight[".concat(e,"].direction")]=t.direction})),o.lighting_uDirectionalLightCount=i.length,o}({ambientLight:t,pointLights:i,directionalLights:o}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in e){const i={pointLights:[],directionalLights:[]};for(const t of e.lights||[])switch(t.type){case"ambient":i.ambientLight=t;break;case"directional":i.directionalLights.push(t);break;case"point":i.pointLights.push(t)}return t({lightSources:i})}return{}},defines:{MAX_LIGHTS:3}}],vs:"\nuniform float lighting_uAmbient;\nuniform float lighting_uDiffuse;\nuniform float lighting_uShininess;\nuniform vec3  lighting_uSpecularColor;\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {\n    vec3 halfway_direction = normalize(light_direction + view_direction);\n    float lambertian = dot(light_direction, normal_worldspace);\n    float specular = 0.0;\n    if (lambertian > 0.0) {\n      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\n      specular = pow(specular_angle, lighting_uShininess);\n    }\n    lambertian = max(lambertian, 0.0);\n    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;\n}\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = surfaceColor;\n\n  if (lighting_uEnabled) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uPointLightCount) {\n        break;\n      }\n      PointLight pointLight = lighting_uPointLight[i];\n      vec3 light_position_worldspace = pointLight.position;\n      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n    }\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uDirectionalLightCount) {\n        break;\n      }\n      DirectionalLight directionalLight = lighting_uDirectionalLight[i];\n      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n    }\n  }\n  return lightColor;\n}\n\nvec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = vec3(0, 0, 0);\n  vec3 surfaceColor = vec3(0, 0, 0);\n\n  if (lighting_uEnabled) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uPointLightCount) {\n        break;\n      }\n      PointLight pointLight = lighting_uPointLight[i];\n      vec3 light_position_worldspace = pointLight.position;\n      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n    }\n\n    for (int i = 0; i < MAX_LIGHTS; i++) {\n      if (i >= lighting_uDirectionalLightCount) {\n        break;\n      }\n      DirectionalLight directionalLight = lighting_uDirectionalLight[i];\n      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n    }\n  }\n  return lightColor;\n}\n",defines:{LIGHTING_VERTEX:1},getUniforms:function(t=a){if(!("material"in t))return{};const{material:e}=t;return e?function(t){const{ambient:e=.35,diffuse:i=.6,shininess:o=32,specularColor:n=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:i,lighting_uShininess:o,lighting_uSpecularColor:n.map((t=>t/255))}}(e):{lighting_uEnabled:!1}}}},22139:(t,e,i)=>{i.d(e,{Z:()=>c});var o=i(67294),n=i(45697),r=i.n(n),a=i(67190);const s=" - ",l={categories:r().object,toggleCategory:r().func,showSingleCategory:r().func,format:r().string,position:r().oneOf([null,"tl","tr","bl","br"])};class c extends o.PureComponent{format(t){if(!this.props.format)return t;const e=parseFloat(t);return(0,a.uf)(this.props.format,e)}formatCategoryLabel(t){if(!this.props.format)return t;if(t.includes(s)){const e=t.split(s);return this.format(e[0])+s+this.format(e[1])}return this.format(t)}render(){if(0===Object.keys(this.props.categories).length||null===this.props.position)return null;const t=Object.entries(this.props.categories).map((t=>{let[e,i]=t;const n={color:"rgba("+i.color.join(", ")+")"},r=i.enabled?"◼":"◻";return o.createElement("li",{key:e},o.createElement("a",{href:"#",onClick:()=>this.props.toggleCategory(e),onDoubleClick:()=>this.props.showSingleCategory(e)},o.createElement("span",{style:n},r)," ",this.formatCategoryLabel(e)))})),e={position:"absolute",["t"===this.props.position.charAt(0)?"top":"bottom"]:"0px",["r"===this.props.position.charAt(1)?"right":"left"]:"10px"};return o.createElement("div",{className:"legend",style:e},o.createElement("ul",{className:"categories"},t))}}c.propTypes=l,c.defaultProps={categories:{},toggleCategory:()=>{},showSingleCategory:()=>{},format:null,position:"tr"}},75647:(t,e,i)=>{i.d(e,{B:()=>A,G:()=>P});var o=i(18446),n=i.n(o),r=i(67294),a=i(45697),s=i.n(a),l=i(37672),c=i(28062),g=i(82134),h=i(22139),u=i(27447),p=i(90483),d=i(40895),f=i(68555);function m(){return m=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o])}return t},m.apply(this,arguments)}function _(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const{getScale:b}=c,L={formData:s().object.isRequired,mapboxApiKey:s().string.isRequired,setControlValue:s().func.isRequired,viewport:s().object.isRequired,getLayer:s().func.isRequired,getPoints:s().func.isRequired,payload:s().object.isRequired,onAddFilter:s().func,width:s().number.isRequired,height:s().number.isRequired};class v extends r.PureComponent{constructor(t){super(t),_(this,"containerRef",r.createRef()),_(this,"setTooltip",(t=>{const{current:e}=this.containerRef;e&&e.setTooltip(t)})),this.state=this.getStateFromProps(t),this.getLayers=this.getLayers.bind(this),this.onValuesChange=this.onValuesChange.bind(this),this.toggleCategory=this.toggleCategory.bind(this),this.showSingleCategory=this.showSingleCategory.bind(this)}UNSAFE_componentWillReceiveProps(t){t.payload.form_data!==this.state.formData&&this.setState(m({},this.getStateFromProps(t)))}onValuesChange(t){this.setState({values:Array.isArray(t)?t:[t,t+this.state.getStep(t)]})}getStateFromProps(t,e){const i=t.payload.data.features||[],o=i.map((t=>t.__timestamp)),n=function(t,e){const i=t.color_picker||{r:0,g:0,b:0,a:1},o=[i.r,i.g,i.b,255*i.a],n=b(t.color_scheme),r={};return e.forEach((e=>{if(null!=e.cat_color&&!r.hasOwnProperty(e.cat_color)){let a;a=t.dimension?(0,u.hexToRGB)(n(e.cat_color),255*i.a):o,r[e.cat_color]={color:a,enabled:!0}}})),r}(t.formData,i);if(e&&t.payload.form_data===e.formData)return m({},e,{categories:n});const r=t.payload.form_data.time_grain_sqla||t.payload.form_data.granularity||"P1D",{start:a,end:s,getStep:l,values:c,disabled:g}=(0,p.g)(o,r),{width:h,height:d,formData:_}=t;let{viewport:L}=t;return _.autozoom&&(L=(0,f.Z)(L,{width:h,height:d,points:t.getPoints(i)})),{start:a,end:s,getStep:l,values:c,disabled:g,viewport:L,selected:[],lastClick:0,formData:t.payload.form_data,categories:n}}getLayers(t){const{getLayer:e,payload:i,formData:o,onAddFilter:n}=this.props;let r=i.data.features?[...i.data.features]:[];r=this.addColor(r,o),o.js_data_mutator&&(r=(0,d.Z)(o.js_data_mutator)(r)),r=t[0]===t[1]||t[1]===this.end?r.filter((e=>e.__timestamp>=t[0]&&e.__timestamp<=t[1])):r.filter((e=>e.__timestamp>=t[0]&&e.__timestamp<t[1]));const a=this.state.categories;return o.dimension&&(r=r.filter((t=>a[t.cat_color]&&a[t.cat_color].enabled))),[e(o,m({},i,{data:m({},i.data,{features:r})}),n,this.setTooltip)]}addColor(t,e){const i=e.color_picker||{r:0,g:0,b:0,a:1},o=b(e.color_scheme);return t.map((t=>{let n;return e.dimension?(n=(0,u.hexToRGB)(o(t.cat_color),255*i.a),m({},t,{color:n})):t}))}toggleCategory(t){const e=this.state.categories[t],i=m({},this.state.categories,{[t]:m({},e,{enabled:!e.enabled})});Object.values(i).every((t=>!t.enabled))&&Object.values(i).forEach((t=>{t.enabled=!0})),this.setState({categories:i})}showSingleCategory(t){const e=m({},this.state.categories);Object.values(e).forEach((t=>{t.enabled=!1})),e[t].enabled=!0,this.setState({categories:e})}render(){return r.createElement("div",{style:{position:"relative"}},r.createElement(g.Z,{ref:this.containerRef,getLayers:this.getLayers,start:this.state.start,end:this.state.end,getStep:this.state.getStep,values:this.state.values,disabled:this.state.disabled,viewport:this.state.viewport,mapboxApiAccessToken:this.props.mapboxApiKey,mapStyle:this.props.formData.mapbox_style,setControlValue:this.props.setControlValue,width:this.props.width,height:this.props.height},r.createElement(h.Z,{categories:this.state.categories,toggleCategory:this.toggleCategory,showSingleCategory:this.showSingleCategory,position:this.props.formData.legend_position,format:this.props.formData.legend_format})))}}function y(){return y=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o])}return t},y.apply(this,arguments)}function C(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}v.propTypes=L;const w={formData:s().object.isRequired,payload:s().object.isRequired,setControlValue:s().func.isRequired,viewport:s().object.isRequired,onAddFilter:s().func,width:s().number.isRequired,height:s().number.isRequired},S={onAddFilter(){}};function P(t,e){class i extends r.PureComponent{constructor(t){super(t),C(this,"containerRef",r.createRef()),C(this,"setTooltip",(t=>{const{current:e}=this.containerRef;e&&e.setTooltip(t)}));const{width:i,height:o,formData:n}=t;let{viewport:a}=t;n.autozoom&&(a=(0,f.Z)(a,{width:i,height:o,points:e(t.payload.data.features)})),this.state={viewport:a,layer:this.computeLayer(t)},this.onViewportChange=this.onViewportChange.bind(this)}UNSAFE_componentWillReceiveProps(t){const e=y({},t.formData,{viewport:null}),i=y({},this.props.formData,{viewport:null});n()(e,i)&&t.payload===this.props.payload||this.setState({layer:this.computeLayer(t)})}onViewportChange(t){this.setState({viewport:t})}computeLayer(e){const{formData:i,payload:o,onAddFilter:n}=e;return t(i,o,n,this.setTooltip)}render(){const{formData:t,payload:e,setControlValue:i,height:o,width:n}=this.props,{layer:a,viewport:s}=this.state;return r.createElement(l.Z,{ref:this.containerRef,mapboxApiAccessToken:e.data.mapboxApiKey,viewport:s,layers:[a],mapStyle:t.mapbox_style,setControlValue:i,width:n,height:o,onViewportChange:this.onViewportChange})}}return i.propTypes=w,i.defaultProps=S,i}function A(t,e){function i(i){const{formData:o,payload:n,setControlValue:a,viewport:s,width:l,height:c}=i;return r.createElement(v,{formData:o,mapboxApiKey:n.data.mapboxApiKey,setControlValue:a,viewport:s,getLayer:t,payload:n,getPoints:e,width:l,height:c})}return i.propTypes=w,i.defaultProps=S,i}},23444:(t,e,i)=>{i.r(e),i.d(e,{getLayer:()=>u,default:()=>p});var o=i(99396),n=i(67294),r=i(61988),a=i(38969),s=i(40895),l=i(75647),c=i(24084);function g(){return g=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o])}return t},g.apply(this,arguments)}function h(t){return n.createElement("div",{className:"deckgl-tooltip"},n.createElement(c.Z,{label:(0,r.t)("Longitude and Latitude")+": ",value:t.coordinate[0]+", "+t.coordinate[1]}),n.createElement(c.Z,{label:(0,r.t)("Height")+": ",value:""+t.object.elevationValue}))}function u(t,e,i,n){const r=t,l=r.color_picker;let c=e.data.features.map((t=>g({},t,{color:[l.r,l.g,l.b,255*l.a]})));r.js_data_mutator&&(c=(0,s.Z)(r.js_data_mutator)(c));const u=(0,a.Z)(r.js_agg_function,(t=>t.weight));return new o.Z(g({id:"grid-layer-"+r.slice_id,data:c,pickable:!0,cellSize:r.grid_size,minColor:[0,0,0,0],extruded:r.extruded,maxColor:[l.r,l.g,l.b,255*l.a],outline:!1,getElevationValue:u,getColorValue:u},(0,a.N)(r,n,h)))}const p=(0,l.G)(u,(function(t){return t.map((t=>t.position))}))}}]);
//# sourceMappingURL=4295197029ee41f3635f.chunk.js.map